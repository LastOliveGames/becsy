<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Queries | Becsy</title>
    <meta name="description" content="Multi-threaded Entity Component System framework for TS and JS.">
    <link rel="stylesheet" href="/becsy/assets/style.06b44467.css">
    <link rel="modulepreload" href="/becsy/assets/app.b3a7bd64.js">
    <link rel="modulepreload" href="/becsy/assets/guide_architecture_queries.md.b77a8941.lean.js">
    
    <meta name="twitter:title" content="Queries | Becsy">
  <meta property="og:title" content="Queries | Becsy">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/becsy/" aria-label="Becsy, back to home" data-v-675d8756 data-v-cc01ef16><img class="logo" src="/becsy/logo_small.png" alt="Logo" data-v-cc01ef16> Becsy</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/becsy/guide/introduction" data-v-b8818f8c>Guide <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>Community</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item isExternal" href="https://discord.gg/X72ct6hZSr" target="_blank" rel="noopener noreferrer" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Discord</span><span class="icon" data-v-bbc27490><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-bbc27490><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item isExternal" href="https://github.com/lastolivegames/becsy/issues" target="_blank" rel="noopener noreferrer" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Issues</span><span class="icon" data-v-bbc27490><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-bbc27490><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/LastOliveGames/becsy/blob/main/CHANGELOG.md" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Release Notes <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/lastolivegames/becsy" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item active" href="/becsy/guide/introduction" data-v-b8818f8c>Guide <!----></a></div></div><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>Community</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item isExternal" href="https://discord.gg/X72ct6hZSr" target="_blank" rel="noopener noreferrer" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Discord</span><span class="icon" data-v-bbc27490><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-bbc27490><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item isExternal" href="https://github.com/lastolivegames/becsy/issues" target="_blank" rel="noopener noreferrer" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Issues</span><span class="icon" data-v-bbc27490><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-bbc27490><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/LastOliveGames/becsy/blob/main/CHANGELOG.md" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Release Notes <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/lastolivegames/becsy" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><p class="sidebar-link-item">Introduction</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/becsy/guide/introduction">What is Becsy?</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/becsy/guide/getting-started">Getting Started</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/becsy/guide/deploying">Deploying</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Architecture</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/becsy/guide/architecture/overview">Overview</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/becsy/guide/architecture/world">World</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/becsy/guide/architecture/components">Components</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/becsy/guide/architecture/entities">Entities</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/becsy/guide/architecture/systems">Systems</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/becsy/guide/architecture/queries">Queries</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#basic-query-syntax">Basic query syntax</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#declaring-entitlements">Declaring entitlements</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#reactive-queries">Reactive queries</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ordering-query-results">Ordering query results</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/becsy/guide/architecture/threading">Multi-threading</a><!----></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Examples</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/becsy/guide/examples/overview">Overview</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/becsy/guide/examples/simple">Simple moving box</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><div style="float:right;background-color:rgba(27, 31, 35, 0.05);padding:5px 10px;border-radius:6px;font-size:0.9rem;"> Code: <input type="radio" id="ts" value="ts" checked style="margin-left:1em;"><label for="ts">TypeScript</label><input type="radio" id="js" value="js" style="margin-left:1em;"><label for="js">JavaScript</label></div><h1 id="queries" tabindex="-1">Queries <a class="header-anchor" href="#queries" aria-hidden="true">#</a></h1><p>A query is a set of constraints to select entities based on the components they have. Queries are always defined in systems at construction time. It&#39;s not possible to run new ad-hoc queries once the world has been created.</p><p>A query is always updated with the entities that match the components&#39; condition immediately before a system is executed. The work needed to keep a query updated is proportional to the number of shape changes (component additions and removals) in the world rather than the total number of entities.</p><h2 id="basic-query-syntax" tabindex="-1">Basic query syntax <a class="header-anchor" href="#basic-query-syntax" aria-hidden="true">#</a></h2><p>Queries use a small domain-specific language to express their constraints and are assigned to system properties at construction time:</p><div class="language-ts"><pre><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">system</span></span> <span class="token keyword">class</span> <span class="token class-name">SystemA</span> <span class="token keyword">extends</span> <span class="token class-name">System</span> <span class="token punctuation">{</span>
  <span class="token comment">// Query for all entities with an Enemy component but no Dead component.</span>
  <span class="token keyword">private</span> activeEnemies <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>q <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Enemy<span class="token punctuation">)</span><span class="token punctuation">.</span>but<span class="token punctuation">.</span><span class="token function">without</span><span class="token punctuation">(</span>Dead<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> entity <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>activeEnemies<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> enemy <span class="token operator">=</span> entity<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>Enemy<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// guaranteed to have an Enemy component</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">SystemA</span> <span class="token keyword">extends</span> <span class="token class-name">System</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Query for all entities with an Enemy component but no Dead component.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>activeEnemies <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token parameter">q</span> <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Enemy<span class="token punctuation">)</span><span class="token punctuation">.</span>but<span class="token punctuation">.</span><span class="token function">without</span><span class="token punctuation">(</span>Dead<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> entity <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>activeEnemies<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> enemy <span class="token operator">=</span> entity<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>Enemy<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// guaranteed to have an Enemy component</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>First you specify that you want all <code>current</code> entities that satisfy the constraints; we&#39;ll introduce other options <a href="#reactive-queries">later</a>. Then you use <code>with</code> and <code>without</code> to constrain what component types an entity must and must not have to satisfy the query. Each clause can list any number of component types, which is equivalent to repeating the clause.</p><p>The query object will have a <code>current</code> property that&#39;s an array of entities you can iterate over in your <code>execute</code> hook.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Queries are only updated between system executions so you don&#39;t need to worry about accidentally mutating the entity array while you&#39;re iterating over it by adding or removing components.</p></div><h2 id="declaring-entitlements" tabindex="-1">Declaring entitlements <a class="header-anchor" href="#declaring-entitlements" aria-hidden="true">#</a></h2><p>Query definitions also have a secondary function: they declare what component types the system will be reading, writing and creating. These declarations are not query-specific — the entitlements from all of a system&#39;s queries are combined together and applied to the system — but it&#39;s a convenient place to express them as you&#39;ll often need to read and write the component types that your queries are constrained on.</p><p>You can only read, write and create component types for which you declared entitlements, otherwise you&#39;ll get an error. Becsy also uses the entitlements to help <a href="./systems.html#execution-order">order system execution</a> and determine which systems can safely run concurrently.</p><p>You declare entitlements by following any clause that mentions component types with a <code>read</code>, <code>write</code>, or <code>create</code>:</p><div class="language-ts"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br></div><pre><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">system</span></span> <span class="token keyword">class</span> <span class="token class-name">Namer</span> <span class="token keyword">extends</span> <span class="token class-name">System</span> <span class="token punctuation">{</span>
  <span class="token comment">// Select all Players that don&#39;t have a Name component yet.</span>
  <span class="token keyword">private</span> uninitializedPlayers <span class="token operator">=</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>q <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Player<span class="token punctuation">)</span><span class="token punctuation">.</span>but<span class="token punctuation">.</span><span class="token function">without</span><span class="token punctuation">(</span>Name<span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> player <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>uninitializedPlayers<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Add a name to each player, which will also remove it from the query.</span>
      player<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>Name<span class="token punctuation">,</span> <span class="token punctuation">{</span>value<span class="token operator">:</span> <span class="token function">getRandomName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js"><div class="highlight-lines"><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br></div><pre><code><span class="token keyword">class</span> <span class="token class-name">Namer</span> <span class="token keyword">extends</span> <span class="token class-name">System</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Select all Players that don&#39;t have a Name component yet.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>uninitializedPlayers <span class="token operator">=</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token parameter">q</span> <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Player<span class="token punctuation">)</span><span class="token punctuation">.</span>but<span class="token punctuation">.</span><span class="token function">without</span><span class="token punctuation">(</span>Name<span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> player <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>uninitializedPlayers<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Add a name to each player, which will also remove it from the query.</span>
      <span class="token comment">// This is a typical &quot;factory&quot; pattern in ECS.</span>
      player<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>Name<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token function">getRandomName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Above, we declared that we&#39;ll be writing the <code>Name</code> component; adding and removing count as writing, as does calling <code>Entity.write</code>. Any <code>with</code> or <code>without</code> component types are automatically marked as <code>read</code> so you don&#39;t need to say it explicitly (but it&#39;s allowed). If you want to declare an entitlement for a component type not used as a query constraint you can employ the <code>using</code> clause, which doesn&#39;t affect the query in any way, only supplies component types for entitlement suffixes: <code>this.query(q =&gt; q.using(RandomComponent).write)</code>.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>write</code> implicitly includes <code>read</code> and <code>create</code>, so you don&#39;t need to declare those separately. <code>read</code> and <code>write</code> also grant you access to the <code>has</code> family of methods, but <code>create</code> does not, as a trade-off for being able to run concurrently.</p></div><h2 id="reactive-queries" tabindex="-1">Reactive queries <a class="header-anchor" href="#reactive-queries" aria-hidden="true">#</a></h2><p>Using reactive queries make it possible to react to changes on entities and its components. One common use case is to detect whenever an entity has been added or removed from a query:</p><div class="language-ts"><pre><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">system</span></span> <span class="token keyword">class</span> <span class="token class-name">SystemA</span> <span class="token keyword">extends</span> <span class="token class-name">System</span> <span class="token punctuation">{</span>
  <span class="token comment">// Query for entities that either became a Box with a Transform, or stopped being one.</span>
  <span class="token keyword">private</span> boxes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>q <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span>added<span class="token punctuation">.</span>and<span class="token punctuation">.</span>removed<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Box<span class="token punctuation">,</span> Transform<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> addedBox <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boxes<span class="token punctuation">.</span>added<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> removedbox <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boxes<span class="token punctuation">.</span>removed<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">SystemA</span> <span class="token keyword">extends</span> <span class="token class-name">System</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Query for entities that either became a Box with a Transform, or stopped being one.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>boxes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token parameter">q</span> <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span>added<span class="token punctuation">.</span>and<span class="token punctuation">.</span>removed<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Box<span class="token punctuation">,</span> Transform<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> addedBox <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boxes<span class="token punctuation">.</span>added<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> removedbox <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>boxes<span class="token punctuation">.</span>removed<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>added</code> and <code>removed</code> lists are computed just before the system executes, and will include all entities that would have been added to or removed from the <code>current</code> list since the system last executed (usually the previous frame).</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>If an entity was both added and then removed between system executions, it will <em>not</em> be included in the <code>added</code> list. (And similarly for the <code>removed</code> list.) There&#39;s currently no way to query for such ephemeral entities in Becsy.</p></div><p>Another common use case is to detect when a component&#39;s field values have been changed, whether due to a call to <code>Entity.write</code> or because the field&#39;s value was <a href="./components.html#referencing-entities">automatically updated</a>:</p><div class="language-ts"><pre><code><span class="token comment">// Get entities with Box and Transform, where Transform fields changed since last time.</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>q <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span>changed<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Box<span class="token punctuation">)</span><span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Transform<span class="token punctuation">)</span><span class="token punctuation">.</span>track<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js"><pre><code><span class="token comment">// Get entities with Box and Transform, where Transform fields changed since last time.</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token parameter">q</span> <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span>changed<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Box<span class="token punctuation">)</span><span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Transform<span class="token punctuation">)</span><span class="token punctuation">.</span>track<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>We express the query as usual, but append <code>track</code> to any component types whose changes we want to track. (You must track at least one component type.)</p><p>Newly added entities will <em>not</em> be included in the <code>changed</code> list, even if their fields were written to after the component was added. Basically, an entity will be in at most one of the <code>added</code>, <code>removed</code>, and <code>changed</code> lists — they never overlap. For convenience, you can request a list that combines any of these attributes instead:</p><div class="language-ts"><pre><code><span class="token comment">// Get entities that became a Box with Transform, or whose Transform was changed.</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>q <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span>addedOrChanged<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Box<span class="token punctuation">)</span><span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Transform<span class="token punctuation">)</span><span class="token punctuation">.</span>track<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js"><pre><code><span class="token comment">// Get entities that became a Box with Transform, or whose Transform was changed.</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token parameter">q</span> <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span>addedOrChanged<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Box<span class="token punctuation">)</span><span class="token punctuation">.</span>and<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Transform<span class="token punctuation">)</span><span class="token punctuation">.</span>track<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Finally, not that a single query can include any or all of the various lists (each of which will be iterable separately), and that this is more efficient than creating separate queries for them.</p><h2 id="ordering-query-results" tabindex="-1">Ordering query results <a class="header-anchor" href="#ordering-query-results" aria-hidden="true">#</a></h2><p>Query results are not guaranteed to be in any specific order by default, but you can request that they be sorted using any kind expression over their entities:</p><div class="language-ts"><pre><code><span class="token decorator"><span class="token at operator">@</span><span class="token function">system</span></span> <span class="token keyword">class</span> <span class="token class-name">Renderer</span> <span class="token keyword">extends</span> <span class="token class-name">System</span> <span class="token punctuation">{</span>
  <span class="token comment">// Query for all Sprites and order by ascending zIndex.</span>
  <span class="token keyword">private</span> sprites <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>
    q <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Sprite<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span>entity <span class="token operator">=&gt;</span> entity<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>Sprite<span class="token punctuation">)</span><span class="token punctuation">.</span>zIndex<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// Iterate over all sprites in order of zIndex.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> entity <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sprites<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">render</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>Sprite<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js"><pre><code><span class="token keyword">class</span> <span class="token class-name">Renderer</span> <span class="token keyword">extends</span> <span class="token class-name">System</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Query for all Sprites and order by ascending zIndex.</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>sprites <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>
      <span class="token parameter">q</span> <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Sprite<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token parameter">entity</span> <span class="token operator">=&gt;</span> entity<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>Sprite<span class="token punctuation">)</span><span class="token punctuation">.</span>zIndex<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Iterate over all sprites in order of zIndex.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> entity <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sprites<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">render</span><span class="token punctuation">(</span>entity<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>Sprite<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>A common case is ordering entities by order of creation, for example to execute queued commands in the right order:</p><div class="language-ts"><pre><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>q <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Command<span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span>entity <span class="token operator">=&gt;</span> entity<span class="token punctuation">.</span>ordinal<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js"><pre><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token parameter">q</span> <span class="token operator">=&gt;</span> q<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>Command<span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token parameter">entity</span> <span class="token operator">=&gt;</span> entity<span class="token punctuation">.</span>ordinal<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>Note that ordering entities can get expensive (though we apply some optimizations for common cases) so use this feature judiciously!</p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-07c132fc><div class="edit" data-v-07c132fc><div class="edit-link" data-v-07c132fc data-v-1ed99556><a class="link" href="https://github.com/lastolivegames/becsy/edit/main/docs/guide/architecture/queries.md" target="_blank" rel="noopener noreferrer" data-v-1ed99556>Edit this page on GitHub <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-1ed99556><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-07c132fc><p class="last-updated" data-v-07c132fc data-v-eed075e6><span class="prefix" data-v-eed075e6>Last updated:</span><span class="datetime" data-v-eed075e6></span></p></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/becsy/guide/architecture/systems" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>Systems</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/becsy/guide/architecture/threading" data-v-38ede35f><span class="text" data-v-38ede35f>Multi-threading</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"guide_architecture_components.md\":\"0ed3e78e\",\"guide_architecture_entities.md\":\"1eb0f994\",\"guide_architecture_overview.md\":\"fbe65d84\",\"guide_architecture_queries.md\":\"b77a8941\",\"guide_architecture_systems.md\":\"038eeacc\",\"guide_architecture_threading.md\":\"2c5c0c64\",\"guide_architecture_world.md\":\"d8aff7a9\",\"guide_deploying.md\":\"bfcbaf12\",\"guide_examples_overview.md\":\"c1512d5e\",\"guide_examples_simple.md\":\"6f95bf07\",\"guide_getting-started.md\":\"1b61d287\",\"guide_introduction.md\":\"8a988a0b\",\"index.md\":\"3d7f9396\"}")</script>
    <script type="module" async src="/becsy/assets/app.b3a7bd64.js"></script>
    
  </body>
</html>