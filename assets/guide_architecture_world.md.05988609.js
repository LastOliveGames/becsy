import{_ as s,c as a,a as t,b as e,r as o,o as p}from"./app.b3a7bd64.js";const f='{"title":"World","description":"","frontmatter":{},"headers":[{"level":2,"title":"Options","slug":"options"},{"level":2,"title":"Creating entities","slug":"creating-entities"},{"level":2,"title":"Multiple worlds","slug":"multiple-worlds"},{"level":2,"title":"Partial execution","slug":"partial-execution"},{"level":3,"title":"Start / stop","slug":"start-stop"},{"level":3,"title":"Custom executor","slug":"custom-executor"}],"relativePath":"guide/architecture/world.md","lastUpdated":1647839898000}',c={},l=e(`<h1 id="world" tabindex="-1">World <a class="header-anchor" href="#world" aria-hidden="true">#</a></h1><p>A world is basically a container for entities, components and systems, and you&#39;ll usually want to have exactly one in your application. You create a world like so:</p><div class="language-js"><pre><code><span class="token keyword">const</span> world <span class="token operator">=</span> <span class="token keyword">await</span> World<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-ts"><pre><code><span class="token keyword">const</span> world <span class="token operator">=</span> <span class="token keyword">await</span> World<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>You can then execute all the world&#39;s systems at any time by calling:</p><div class="language-js"><pre><code><span class="token keyword">await</span> world<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// use Becsy&#39;s built-in clock</span>
<span class="token keyword">await</span> world<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span> delta<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// or control the clock yourself</span>
</code></pre></div><div class="language-ts"><pre><code><span class="token keyword">await</span> world<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// use Becsy&#39;s built-in clock</span>
<span class="token keyword">await</span> world<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>time<span class="token punctuation">,</span> delta<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// or control the clock yourself</span>
</code></pre></div><p>You&#39;ll typically do this in some kind of loop, perhaps using <code>requestAnimationFrame</code> or one of the many game loop libraries out there.</p><h2 id="options" tabindex="-1">Options <a class="header-anchor" href="#options" aria-hidden="true">#</a></h2><p>The <code>create</code> method accepts an object with many options, the most important of which is <code>defs</code>: an arbitrarily nested array of <a href="./components.html">component</a> and <a href="./systems.html">system</a> types for the world to be aware of. The order of items and nesting of arrays doesn&#39;t matter \u2014 specifically, it doesn&#39;t affect the order that systems are executed in whatsoever. You can also follow each system type with an object to be assigned onto the system instance&#39;s properties. If you defined any <a href="./systems.html#groups">system groups</a> they should also be listed here, and will automatically add all their systems.</p><div class="only-ts"><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>You can usually omit <code>defs</code> altogether as any classes decorated with <code>@component</code> or <code>@system</code> will automatically be added to the <code>defs</code> of every world you create.</p></div></div><p>Another important option is <code>maxEntities</code>, which specifies the maximum number of entities your world will be able to hold at one time. It must be set up front and cannot be raised once a world has been created. It&#39;s set to a reasonable default and you&#39;ll get an error advising you to raise it if you should exceed it. (Note that deleted entities continue counting against the total for up to 2 frames until they&#39;re purged.) There are also a number of other buffer sizing options that are defaulted based on the maximum number of entities, and where again an error will tell you if you need to raise their values.</p><h2 id="creating-entities" tabindex="-1">Creating entities <a class="header-anchor" href="#creating-entities" aria-hidden="true">#</a></h2><p>You may want to set up some initial entities to populate your world. Normally you&#39;d leave this up to your systems, but you can also do it directly here. Note, however, that all your systems will have already been initialized by the time world-level entities are created.</p><p>The easiest way to create an entity is like so:</p><div class="language-js"><pre><code>world<span class="token punctuation">.</span><span class="token function">createEntity</span><span class="token punctuation">(</span>ComponentFoo<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">&#39;bar&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">baz</span><span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">}</span><span class="token punctuation">,</span> ComponentBar<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-ts"><pre><code>world<span class="token punctuation">.</span><span class="token function">createEntity</span><span class="token punctuation">(</span>ComponentFoo<span class="token punctuation">,</span> <span class="token punctuation">{</span>foo<span class="token operator">:</span> <span class="token string">&#39;bar&#39;</span><span class="token punctuation">,</span> baz<span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">}</span><span class="token punctuation">,</span> ComponentBar<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This creates an entity that contains components of the given types. Each type can also be followed by initial values to assign to the component&#39;s fields.</p><p>The method above <em>doesn&#39;t</em> return a handle to the entity created. If you need that \u2014 for example to initialize some <code>ref</code> fields \u2014 then you should use the second form that gives you access to a fake system:</p><div class="language-js"><pre><code>world<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token parameter">sys</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> entity1 <span class="token operator">=</span> sys<span class="token punctuation">.</span><span class="token function">createEntity</span><span class="token punctuation">(</span>ComponentFoo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  sys<span class="token punctuation">.</span><span class="token function">createEntity</span><span class="token punctuation">(</span>ComponentBar<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">fooRef</span><span class="token operator">:</span> entity1<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-ts"><pre><code>world<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>sys <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> entity1 <span class="token operator">=</span> sys<span class="token punctuation">.</span><span class="token function">createEntity</span><span class="token punctuation">(</span>ComponentFoo<span class="token punctuation">)</span><span class="token punctuation">;</span>
  sys<span class="token punctuation">.</span><span class="token function">createEntity</span><span class="token punctuation">(</span>ComponentBar<span class="token punctuation">,</span> <span class="token punctuation">{</span>fooRef<span class="token operator">:</span> entity1<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Be careful not to exfiltrate entity handles from the build block without first <a href="./entities.html#holding-handles">calling <code>hold()</code></a> on the entity.</p></div><h2 id="multiple-worlds" tabindex="-1">Multiple worlds <a class="header-anchor" href="#multiple-worlds" aria-hidden="true">#</a></h2><p>While usually one world is enough sometimes you&#39;ll want more, in which case there&#39;s an important limitation to be aware of: a single component type can only be used in one world at a time due to performance concerns. (This doesn&#39;t apply to systems.)</p><p>The limitation doesn&#39;t apply in unit tests (<code>NODE_ENV=test</code>) as you&#39;ll often want one world per test there, and the worlds will never execute concurrently.</p><p>Outside of tests, if you need multiple consecutive worlds then calling <code>world.terminate()</code> will make all its component types available for the next world. If, on the other hand, you want multiple worlds to gain control over which systems to execute when, keep reading!</p><h2 id="partial-execution" tabindex="-1">Partial execution <a class="header-anchor" href="#partial-execution" aria-hidden="true">#</a></h2><p>There are some more advanced use cases where you don&#39;t want every system to execute once in every frame. For example, you may have different systems running in different scenes in your game, or you want to run your physics systems at a fixed time interval but sync the render systems to the screen&#39;s refresh. Becsy caters for these scenarios in two ways.</p><h3 id="start-stop" tabindex="-1">Start / stop <a class="header-anchor" href="#start-stop" aria-hidden="true">#</a></h3><p>First, you can explicitly stop and restart systems like so:</p><div class="language-js"><pre><code>world<span class="token punctuation">.</span><span class="token function">control</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">stop</span><span class="token operator">:</span> <span class="token punctuation">[</span>SystemA<span class="token punctuation">,</span> systemGroupB<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token comment">// these systems will be stopped</span>
  <span class="token literal-property property">restart</span><span class="token operator">:</span> <span class="token punctuation">[</span>SystemC<span class="token punctuation">,</span> systemGroupD<span class="token punctuation">]</span>  <span class="token comment">// these systems will be started</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-ts"><pre><code>world<span class="token punctuation">.</span><span class="token function">control</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  stop<span class="token operator">:</span> <span class="token punctuation">[</span>SystemA<span class="token punctuation">,</span> systemGroupB<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token comment">// these systems will be stopped</span>
  restart<span class="token operator">:</span> <span class="token punctuation">[</span>SystemC<span class="token punctuation">,</span> systemGroupD<span class="token punctuation">]</span>  <span class="token comment">// these systems will be started</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This will stop the given systems and restart others. The effect is immediate unless you&#39;re in the middle of a frame, in which case it will take effect at the end of the frame. You&#39;ll typically use custom <a href="./systems.html#groups">system groups</a> as arguments here but you can actually pass in anything that the world <code>defs</code> accepts and irrelevant items will just be ignored.</p><p>Stopped systems will have nearly zero impact on frame latency. However, restarting a system that has queries is a fairly slow operation so you don&#39;t want to be doing that too often.</p><h3 id="custom-executor" tabindex="-1">Custom executor <a class="header-anchor" href="#custom-executor" aria-hidden="true">#</a></h3><p>If you do need to control what systems execute on a frame-by-frame basis then you&#39;ll want the second option: create a custom executor.</p><div class="language-js"><pre><code><span class="token comment">// First, create a new frame with all the groups you may want to execute</span>
<span class="token keyword">const</span> frame <span class="token operator">=</span> world<span class="token punctuation">.</span><span class="token function">createCustomExecutor</span><span class="token punctuation">(</span>physicsGroup<span class="token punctuation">,</span> renderGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// then later, in your game loop, you begin a new frame:</span>
  <span class="token keyword">await</span> frame<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// execute any groups from the list above, any number of times:</span>
  <span class="token keyword">await</span> frame<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>physicsGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> frame<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>physicsGroup<span class="token punctuation">,</span> time<span class="token punctuation">,</span> delta<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// optionally assume control of the clock</span>
  <span class="token keyword">await</span> frame<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>renderGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// and close out the frame:</span>
  <span class="token keyword">await</span> frame<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-ts"><pre><code><span class="token comment">// First, create a new frame with all the groups you may want to execute</span>
<span class="token keyword">const</span> frame <span class="token operator">=</span> world<span class="token punctuation">.</span><span class="token function">createCustomExecutor</span><span class="token punctuation">(</span>physicsGroup<span class="token punctuation">,</span> renderGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// then later, in your game loop, you begin a new frame:</span>
  <span class="token keyword">await</span> frame<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// execute any groups from the list above, any number of times:</span>
  <span class="token keyword">await</span> frame<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>physicsGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> frame<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>physicsGroup<span class="token punctuation">,</span> time<span class="token punctuation">,</span> delta<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// optionally assume control of the clock</span>
  <span class="token keyword">await</span> frame<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>renderGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// and close out the frame:</span>
  <span class="token keyword">await</span> frame<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This approach is efficient, but beware: <em>every group in your custom executor must be executed regularly</em>, though not necessarily every frame. The longer the interval between all groups being executed, the larger the world&#39;s buffer requirements and the higher the latency when you do finally execute a group.</p>`,39);function u(i,r,d,k,m,y){const n=o("language-switcher");return p(),a("div",null,[t(n),l])}var w=s(c,[["render",u]]);export{f as __pageData,w as default};
